<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy Bird - Big Boss Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background-color: #70c5ce; font-family: 'Arial Black', sans-serif; user-select: none; -webkit-tap-highlight-color: transparent; }
        canvas { display: block; margin: 0 auto; touch-action: none; background-color: #70c5ce; }
        #ui-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; pointer-events: none; z-index: 10; }
        .btn { pointer-events: auto; cursor: pointer; transition: transform 0.1s; z-index: 20; }
        .btn:active { transform: scale(0.95); }
        #ability-tag { position: absolute; top: 120px; font-size: 1.2rem; font-weight: 900; color: #fff; text-shadow: 2px 2px #000; text-transform: uppercase; background: rgba(0,0,0,0.5); padding: 6px 16px; border-radius: 30px; opacity: 0; transition: opacity 0.3s; border: 2px solid #fff; }
        #boss-warning { color: #ff0000; font-weight: 900; font-size: 3rem; text-shadow: 3px 3px #000; animation: blink 0.2s infinite; text-transform: uppercase; display: none; }
        @keyframes blink { 0%, 100% { opacity: 1; transform: scale(1.1); } 50% { opacity: 0.5; transform: scale(1); } }
    </style>
</head>
<body>

    <div id="ui-overlay">
        <div id="start-screen" class="text-center">
            <h1 class="text-5xl font-bold text-white drop-shadow-lg mb-2" style="-webkit-text-stroke: 1.5px #543847;">FLAPPY BIRD</h1>
            <div class="mb-8">
                <p class="text-white text-xs font-bold tracking-widest mb-1">Created by</p>
                <h2 class="text-red-600 text-3xl font-black drop-shadow-md">SHIVANSH KASHYAP</h2>
            </div>
            <button id="start-btn" class="btn bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-10 rounded-lg border-b-4 border-orange-800 text-2xl">START GAME</button>
        </div>

        <div id="game-over-screen" class="hidden text-center bg-white/90 p-8 rounded-2xl shadow-2xl border-4 border-orange-400">
            <h2 class="text-4xl font-bold text-orange-600 mb-2">GAME OVER</h2>
            <p id="final-score" class="text-3xl font-bold text-gray-800 mb-1">Score: 0</p>
            <p id="high-score" class="text-xl font-bold text-gray-500 mb-6">Best: 0</p>
            <button id="restart-btn" class="btn bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-lg border-b-4 border-orange-800 text-xl">RETRY</button>
        </div>

        <div id="boss-warning">BOSS INCOMING!</div>
        <div id="ability-tag">GHOST MODE</div>
        <div id="score-display" class="hidden absolute top-12 text-6xl font-black text-white drop-shadow-lg" style="-webkit-text-stroke: 2px #000;">0</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const GRAVITY = 0.22;
        const JUMP_STRENGTH = -4.8;
        let pipeSpeed = 2.4;
        const PIPE_GAP = 180; 
        const BIRD_SIZE_W = 38;
        const BIRD_SIZE_H = 30;

        let gameState = 'START'; 
        let score = 0;
        let highScore = localStorage.getItem('flappyHighScore') || 0;
        let frameCount = 0;

        let bird = { x: 0, y: 0, velocity: 0, width: BIRD_SIZE_W, height: BIRD_SIZE_H, rotation: 0 };
        let activeAbility = null;
        let abilityTimer = 0;
        let abilityItems = []; 
        let nextAbilityScore = 15;

        const BOSS_MILESTONES = [20, 50, 100, 150, 200];
        let bossActive = false;
        let bossTriggeredScores = new Set();
        // Boss is now significantly larger (approx 1.5x of bird)
        let boss = { x: 0, y: 0, width: BIRD_SIZE_W * 1.55, height: BIRD_SIZE_H * 1.55, timer: 0, state: 'FOLLOW', dashCooldown: 120, homeX: 0, rotation: 0 };

        let pipes = [];
        let skyline = [];
        let clouds = [];

        function resize() {
            canvas.width = Math.min(window.innerWidth, 480);
            canvas.height = window.innerHeight;
            bird.x = canvas.width / 4;
            bird.y = canvas.height / 2;
            initBackground();
        }

        function initBackground() {
            clouds = [];
            for(let i=0; i<5; i++) {
                clouds.push({ x: Math.random() * canvas.width, y: Math.random() * (canvas.height * 0.4), speed: 0.2 + Math.random() * 0.5, scale: 0.8 + Math.random() * 0.6 });
            }
            skyline = [];
            for(let i=0; i<12; i++) skyline.push({ x: i*50, h: 80+Math.random()*100, w: 51, color: i%2===0 ? '#b8e1e4' : '#a2d6d9' });
        }

        window.addEventListener('resize', resize);
        resize();

        function drawCloud(c) {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            const {x, y, scale: s} = c;
            ctx.beginPath();
            ctx.arc(x, y, 20*s, 0, Math.PI*2);
            ctx.arc(x+15*s, y-10*s, 18*s, 0, Math.PI*2);
            ctx.arc(x+30*s, y, 20*s, 0, Math.PI*2);
            ctx.arc(x+15*s, y+10*s, 15*s, 0, Math.PI*2);
            ctx.fill();
        }

        function spawnPipe() {
            const isMilestone = BOSS_MILESTONES.includes(score + 1);
            if (bossActive || isMilestone) return;
            
            const minH = 60;
            const maxH = canvas.height - PIPE_GAP - minH - 120;
            const top = Math.floor(Math.random() * (maxH - minH + 1)) + minH;
            pipes.push({ x: canvas.width, top, passed: false });

            if (score >= nextAbilityScore) {
                const types = ['GHOST MODE', 'SHRINK', 'SLOW MO', 'SHIELD', 'WIDE GAP'];
                const colors = ['#ffffff', '#00ffff', '#ffff00', '#00ff00', '#ff8800'];
                const idx = Math.floor(Math.random() * types.length);
                abilityItems.push({ 
                    x: canvas.width + 120, 
                    y: top + PIPE_GAP / 2, 
                    type: types[idx],
                    color: colors[idx],
                    w: 28, h: 28, rotation: 0 
                });
                nextAbilityScore = score + 25 + Math.floor(Math.random() * 20);
            }
        }

        function drawBird(x, y, w, h, rot, isBoss = false) {
            ctx.save();
            ctx.translate(x + w / 2, y + h / 2);
            ctx.rotate(rot);
            if (isBoss) ctx.scale(-1, 1); 
            
            ctx.lineWidth = 2.5; ctx.strokeStyle = 'black';
            if (!isBoss && activeAbility === 'GHOST MODE') ctx.globalAlpha = 0.5;
            
            if (isBoss) {
                if (boss.state === 'CHARGE') {
                    ctx.fillStyle = (Math.floor(frameCount / 4) % 2 === 0) ? '#FFFFFF' : '#FF0000';
                } else {
                    ctx.fillStyle = '#FF0000';
                }
            } else {
                ctx.fillStyle = (activeAbility === 'SHRINK' ? '#00FFFF' : (activeAbility === 'SHIELD' ? '#00FF00' : (activeAbility === 'GHOST MODE' ? '#ffffff' : '#FFD700')));
            }
            
            ctx.beginPath(); ctx.ellipse(0, 0, w/2, h/2, 0, 0, Math.PI * 2); ctx.fill(); ctx.stroke();
            
            if (activeAbility === 'SHIELD' && !isBoss) {
                ctx.strokeStyle = '#00ff00'; ctx.lineWidth = 4;
                ctx.beginPath(); ctx.arc(0, 0, w*0.8, 0, Math.PI*2); ctx.stroke();
                ctx.lineWidth = 2.5; ctx.strokeStyle = 'black';
            }

            const wingY = Math.sin(frameCount * (isBoss ? 0.8 : 0.5)) * (h/4);
            ctx.fillStyle = 'white';
            ctx.beginPath(); ctx.ellipse(-w*0.1, wingY, w*0.25, h*0.22, 0, 0, Math.PI * 2); ctx.fill(); ctx.stroke();
            
            ctx.fillStyle = 'white';
            ctx.beginPath(); ctx.arc(w*0.2, -h*0.18, h*0.3, 0, Math.PI * 2); ctx.fill(); ctx.stroke();
            ctx.fillStyle = 'black';
            ctx.beginPath(); ctx.arc(w*0.26, -h*0.18, h*0.08, 0, Math.PI * 2); ctx.fill();
            
            ctx.fillStyle = isBoss ? '#440000' : '#FF4500';
            ctx.beginPath();
            const bw = w * 0.45;
            ctx.moveTo(w*0.4, -h*0.1); ctx.lineTo(w*0.4 + bw, 0.05); ctx.lineTo(w*0.4, h*0.3);
            ctx.fill(); ctx.stroke();
            ctx.restore();
        }

        function update() {
            if (gameState !== 'PLAYING') return;
            frameCount++;

            clouds.forEach(c => {
                c.x -= c.speed;
                if (c.x < -100) { c.x = canvas.width + 100; c.y = Math.random() * (canvas.height * 0.4); }
            });

            if (activeAbility) {
                abilityTimer--;
                if (abilityTimer <= 0) {
                    pipeSpeed = 2.4;
                    activeAbility = null;
                    bird.width = BIRD_SIZE_W; bird.height = BIRD_SIZE_H;
                    document.getElementById('ability-tag').style.opacity = 0;
                }
            }

            bird.velocity += GRAVITY;
            bird.y += bird.velocity;
            bird.rotation = Math.min(Math.PI/2, Math.max(-Math.PI/6, bird.velocity * 0.12));

            if (BOSS_MILESTONES.includes(score) && !bossActive && !bossTriggeredScores.has(score)) {
                bossActive = true;
                bossTriggeredScores.add(score);
                pipes = [];
                boss.x = canvas.width + 150;
                boss.y = canvas.height / 2;
                boss.homeX = canvas.width - (boss.width + 50);
                boss.timer = 0;
                boss.state = 'FOLLOW';
                boss.dashCooldown = 120;
                document.getElementById('boss-warning').style.display = 'block';
                setTimeout(() => document.getElementById('boss-warning').style.display = 'none', 1500);
            }

            if (bossActive) {
                boss.timer++;
                boss.rotation = Math.sin(frameCount * 0.1) * 0.2;
                
                if (boss.state === 'FOLLOW') {
                    if (boss.x > boss.homeX) boss.x -= 2;
                    boss.y += (bird.y - (boss.y + boss.height/2) + bird.height/2) * 0.045;
                    boss.dashCooldown--;
                    if (boss.dashCooldown <= 0) { 
                        boss.state = 'CHARGE'; 
                        boss.dashCooldown = 60; 
                    }
                } else if (boss.state === 'CHARGE') {
                    boss.dashCooldown--;
                    boss.y += (Math.random() - 0.5) * 8;
                    if (boss.dashCooldown <= 0) { 
                        boss.state = 'DASH'; 
                    }
                } else if (boss.state === 'DASH') {
                    boss.x -= 20;
                    if (boss.x < -boss.width - 100) {
                        boss.state = 'RECOVER';
                        boss.x = -boss.width - 50; 
                    }
                } else if (boss.state === 'RECOVER') {
                    if (boss.x < boss.homeX) {
                        boss.x += 12;
                    } else {
                        boss.x = boss.homeX;
                        boss.state = 'FOLLOW';
                        boss.dashCooldown = 140;
                    }
                }

                // Accurate Circular/Rect Collision
                const dx = (bird.x + bird.width/2) - (boss.x + boss.width/2);
                const dy = (bird.y + bird.height/2) - (boss.y + boss.height/2);
                // Adjusted distance threshold for bigger boss
                if (Math.sqrt(dx*dx + dy*dy) < (boss.width/2 + bird.width/2 - 5) && activeAbility !== 'GHOST MODE') {
                    if (activeAbility === 'SHIELD') {
                        activeAbility = null; bird.width = BIRD_SIZE_W; bird.height = BIRD_SIZE_H; 
                        document.getElementById('ability-tag').style.opacity = 0;
                        if(boss.state === 'DASH') { boss.state = 'RECOVER'; boss.x = -boss.width - 50; }
                    } else endGame();
                }

                if (boss.timer >= 1200) { bossActive = false; score++; document.getElementById('score-display').innerText = score; }
            } else {
                if (pipes.length === 0 || pipes[pipes.length - 1].x < canvas.width - 240) spawnPipe();
                for (let i = pipes.length - 1; i >= 0; i--) {
                    let p = pipes[i]; p.x -= pipeSpeed;
                    const pw = 65;
                    const gapHeight = activeAbility === 'WIDE GAP' ? PIPE_GAP + 60 : PIPE_GAP;
                    
                    if (activeAbility !== 'GHOST MODE') {
                        if (bird.x + bird.width*0.7 > p.x && bird.x + bird.width*0.2 < p.x + pw) {
                            if (bird.y + bird.height*0.2 < p.top || bird.y + bird.height*0.8 > p.top + gapHeight) {
                                if (activeAbility === 'SHIELD') {
                                    activeAbility = null; document.getElementById('ability-tag').style.opacity = 0;
                                } else endGame();
                            }
                        }
                    }
                    if (!p.passed && bird.x > p.x + pw) {
                        p.passed = true; score++; document.getElementById('score-display').innerText = score;
                    }
                    if (p.x < -100) pipes.splice(i, 1);
                }
            }

            for (let i = abilityItems.length - 1; i >= 0; i--) {
                let s = abilityItems[i]; s.x -= pipeSpeed;
                if (Math.abs(bird.x - s.x) < 40 && Math.abs(bird.y - s.y) < 40) {
                    activeAbility = s.type;
                    abilityTimer = 500;
                    if (activeAbility === 'SHRINK') { bird.width = BIRD_SIZE_W/2; bird.height = BIRD_SIZE_H/2; }
                    else if (activeAbility === 'SLOW MO') pipeSpeed = 1.4;
                    document.getElementById('ability-tag').innerText = activeAbility;
                    document.getElementById('ability-tag').style.opacity = 1;
                    abilityItems.splice(i, 1);
                } else if (s.x < -50) abilityItems.splice(i, 1);
            }

            if (bird.y + bird.height > canvas.height - 80 || bird.y < -50) endGame();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            skyline.forEach(s => { ctx.fillStyle = s.color; ctx.fillRect(s.x, canvas.height - 80 - s.h, s.w, s.h); });
            clouds.forEach(c => drawCloud(c));
            
            pipes.forEach(p => {
                const pw = 65;
                const gapH = activeAbility === 'WIDE GAP' ? PIPE_GAP + 60 : PIPE_GAP;
                const grad = ctx.createLinearGradient(p.x, 0, p.x + pw, 0);
                grad.addColorStop(0, '#4a6e1a'); grad.addColorStop(0.5, '#c9f28e'); grad.addColorStop(1, '#4a6e1a');
                ctx.fillStyle = grad; ctx.strokeStyle = '#000'; ctx.lineWidth = 2.5;
                ctx.fillRect(p.x, 0, pw, p.top - 25); ctx.strokeRect(p.x, 0, pw, p.top - 25);
                ctx.fillRect(p.x - 5, p.top - 25, pw + 10, 25); ctx.strokeRect(p.x - 5, p.top - 25, pw + 10, 25);
                ctx.fillRect(p.x, p.top + gapH + 25, pw, canvas.height); ctx.strokeRect(p.x, p.top + gapH + 25, pw, canvas.height);
                ctx.fillRect(p.x - 5, p.top + gapH, pw + 10, 25); ctx.strokeRect(p.x - 5, p.top + gapH, pw + 10, 25);
            });

            abilityItems.forEach(s => {
                ctx.save(); ctx.translate(s.x + s.w/2, s.y + s.h/2); s.rotation += 0.1; ctx.rotate(s.rotation);
                ctx.fillStyle = s.color; ctx.beginPath();
                for(let i=0; i<5; i++) { 
                    ctx.lineTo(Math.cos((18+i*72)/180*Math.PI)*18, -Math.sin((18+i*72)/180*Math.PI)*18); 
                    ctx.lineTo(Math.cos((54+i*72)/180*Math.PI)*9, -Math.sin((54+i*72)/180*Math.PI)*9); 
                }
                ctx.closePath(); ctx.fill(); ctx.stroke(); ctx.restore();
            });

            if (bossActive) {
                drawBird(boss.x, boss.y, boss.width, boss.height, boss.rotation, true);
                ctx.fillStyle = 'rgba(0,0,0,0.6)'; ctx.fillRect(60, 45, canvas.width - 120, 15);
                ctx.fillStyle = '#ef4444'; ctx.fillRect(60, 45, (canvas.width - 120) * (1 - boss.timer/1200), 15);
            }

            ctx.fillStyle = '#dfd991'; ctx.fillRect(0, canvas.height - 80, canvas.width, 80);
            ctx.fillStyle = '#73be2e'; ctx.fillRect(0, canvas.height - 80, canvas.width, 15);
            drawBird(bird.x, bird.y, bird.width, bird.height, bird.rotation);
        }

        function endGame() {
            if (gameState === 'GAMEOVER') return;
            gameState = 'GAMEOVER';
            if (score > highScore) { highScore = score; localStorage.setItem('flappyHighScore', highScore); }
            document.getElementById('final-score').innerText = `Score: ${score}`;
            document.getElementById('high-score').innerText = `Best: ${highScore}`;
            document.getElementById('game-over-screen').classList.remove('hidden');
            document.getElementById('score-display').classList.add('hidden');
            document.getElementById('boss-warning').style.display = 'none';
        }

        function startGame() {
            score = 0; pipes = []; abilityItems = []; activeAbility = null; frameCount = 0;
            bossActive = false; bossTriggeredScores.clear(); bird.width = BIRD_SIZE_W; bird.height = BIRD_SIZE_H;
            bird.y = canvas.height / 2; bird.velocity = 0; bird.rotation = 0; pipeSpeed = 2.4;
            nextAbilityScore = 15;
            gameState = 'PLAYING';
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            document.getElementById('score-display').classList.remove('hidden');
            document.getElementById('score-display').innerText = '0';
            document.getElementById('ability-tag').style.opacity = 0;
        }

        window.addEventListener('mousedown', () => { if (gameState === 'PLAYING') bird.velocity = JUMP_STRENGTH; });
        window.addEventListener('touchstart', (e) => {
            if (gameState === 'PLAYING') { e.preventDefault(); bird.velocity = JUMP_STRENGTH; }
        }, {passive: false});

        document.getElementById('start-btn').onclick = (e) => { e.stopPropagation(); startGame(); };
        document.getElementById('restart-btn').onclick = (e) => { e.stopPropagation(); startGame(); };

        function loop() { update(); draw(); requestAnimationFrame(loop); }
        loop();
    </script>
</body>
</html>

